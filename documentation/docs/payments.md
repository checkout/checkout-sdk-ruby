---
id: payments
title: Payments
---

You can find a list of request body parameters and possible outcomes [here](https://api-reference.checkout.com/#tag/Payments).

export const Highlight = ({children, color}) => (
<span
style={{
      color: color,
      padding: '0.2rem',
    }}>
{children}
</span>
);

:::important

#### Using boolean/falsy values

"nil" or empty strings will be stripped from API calls

```ruby
# ignored
payment_request_source.capture = nil
payment_request_source.capture = ""
```

but "false" or 0 are retained and sent in the request

```ruby
# sent
payment_request_source.capture = false
payment_request_source.capture = 0
```
See [api_resource_spec](https://github.com/checkout/checkout-sdk-ruby/blob/master/spec/checkout_sdk/api_resource_spec.rb#L10-L24) for details.

:::

## Request a card payment with a <Highlight color="#25c2a0">card token</Highlight>

The card token is generated by front-end integration options such as [Frames](https://docs.checkout.com/docs/frames) or one of the [Mobile SDKs](https://docs.checkout.com/docs/sdks#section-mobile-sdk-libraries). Keep in mind that this token expires in 15 minutes and can only be used once.

```ruby
payment_request_source = CheckoutSdk::PaymentRequestSource.new
payment_request_source.type = "token"
payment_request_source.token = "tok_ubfj2q76miwundwlk72vxt2i7q"
payment_request_source.amount = 1000
payment_request_source.currency = "GBP"
payment_request_source.reference = "ORD-090857"

# Send API call
response = api_resource.request_payment(payment_request_source)

# response parsing
puts(response.data) # => {...}
puts(response.body) # => "..."
```

## Request a card payment with a <Highlight color="#25c2a0">full card details</Highlight>

:::warning

You need to have a high level of PCI Compliance (SAQ-D) to be able to send requests with full card details. Note that unless this payment option is enabled on your account by Checkout.com, the <Highlight color="#5A522C">request will fail</Highlight>. Contact you account manager to request access for this payment interaction.

:::

```ruby
payment_request_source = CheckoutSdk::PaymentRequestSource.new
payment_request_source.type = "card"
payment_request_source.card_number = "4242424242424242"
payment_request_source.card_expiry_month = 6
payment_request_source.card_expiry_year = 2025
payment_request_source.card_name = "Bruce Wayne"
payment_request_source.card_cvv = "100"
payment_request_source.amount = 1000
payment_request_source.currency = "GBP"

# Send API call
response = api_resource.request_payment(payment_request_source)

# response parsing
puts(response.data) # => {...}
puts(response.body) # => "..."
```

## Request a card payment with a <Highlight color="#25c2a0">an existing card</Highlight>

After you perform at least one successful payment for a customer, Checkout.com will return a <Highlight color="#02b48f">source.id</Highlight>. This id does not expire, so it can be used to perform subsequent payments without needing the customer to enter the card details again.

```ruby
payment_request_source = CheckoutSdk::PaymentRequestSource.new
payment_request_source.type = "id"
payment_request_source.token = "src_vg3tm54ndfbefotjlmgrrvbxli"
payment_request_source.amount = 1000
payment_request_source.currency = "GBP"

# Send API call
response = api_resource.request_payment(payment_request_source)

# response parsing
puts(response.data) # => {...}
puts(response.body) # => "..."
```

## Request a <Highlight color="#25c2a0">3D Secure payment</Highlight>

You have the ability to authenticate with 3DS in a payment request. The request body is similar to normal card payments, but with some additional parameters. [Read more about 3DS](https://docs.checkout.com/docs/3d-secure-payments)

```ruby
payment_request_source = CheckoutSdk::PaymentRequestSource.new
payment_request_source.type = "token"
payment_request_source.token = "tok_ubfj2q76miwundwlk72vxt2i7q"
payment_request_source.amount = 1000
payment_request_source.currency = "GBP"
payment_request_source.reference = "ORD-090857"
payment_request_source.threeds_enabled = true

# Send API call
response = api_resource.request_payment(payment_request_source)

# response parsing
puts(response.data) # => {...}
puts(response.body) # => "..."
```

3D Secure payments will return a redirection URL. Here is an example of a 3DS response:

```json
{
  "id": "pay_hehfmlkpykeupofyxf7nbr6yyy",
  "status": "Pending",
  "customer": {
    "id": "cus_u4a4zosnrw7ehhzr7jipbkdzo4"
  },
  "3ds": {
    "downgraded": false,
    "enrolled": "Y"
  },
  "_links": {
    "self": {
      "href": "https://api.sandbox.checkout.com/payments/pay_hehfmlkpykeupofyxf7nbr6yyy"
    },
    "redirect": {
      "href": "https://sandbox.checkout.com/api2/v2/3ds/acs/sid_feixbit6us3utfedjulm6egnsu"
    }
  }
}
```

You can access the redirection URL via the SDK like so:

```ruby
redirectURL = response.data._links.redirect.href
```

## Get payment details

```ruby
details = api_resource.get_payment_details("pay_juevt3h5mcjulir2t5g3wfug6u") # or with session id sid_XXX
```

## Get payment actions

```ruby
actions = api_resource.get_payment_actions("pay_juevt3h5mcjulir2t5g3wfug6u")
```

## Capture a payment

```ruby
capture_payment = CheckoutSdk::CapturePayment.new
capture_payment.id = "pay_y3oqhf46pyzuxjbcn2giaqnb44"
capture_payment.amount = "1000"
capture_payment.reference = "your reference"

response = api_resource.capture_payment(capture_payment)
```

## Refund a payment

```ruby
refund_payment = CheckoutSdk::RefundPayment.new
refund_payment.id = "pay_y3oqhf46pyzuxjbcn2giaqnb44"
refund_payment.amount = "1000"
refund_payment.reference = "your reference"

response = api_resource.refund_payment(refund_payment)
```

## Void a payment

```ruby
void_payment = CheckoutSdk::VoidPayment.new
void_payment.id = "pay_y3oqhf46pyzuxjbcn2giaqnb44"
void_payment.reference = "your reference"

response = api_resource.void_payment(void_payment)
```
